# エンティティ定義

## エンティティ定義記載内容

### 1. テーブル基本情報

そのテーブルがシステム全体の中でどのような役割を持つかを定義します。

* **テーブル論理名**: 日本語での名称（例：顧客マスタ、注文ヘッダ）。
* **テーブル物理名**: データベース上の名前（例：`m_customer`, `t_order_header`）。
* **テーブルの説明**: 何のデータを管理するためのテーブルか、どのような単位で1レコードが作られるか（例：1回の注文につき1レコード作成）。
* **テーブル区分**: マスタ（基本情報）か、トランザクション（履歴・活動情報）かの区別。

---

### 2. カラム詳細情報（データ項目定義）

各項目（カラム）の仕様を詳細に定義します。ここが仕様書のメイン部分です。

| 項目 | 内容 |
| :--- | :--- |
| **カラム論理名** | 項目名（例：顧客ID、生年月日）。 |
| **カラム物理名** | DB上のカラム名（例：`customer_id`, `birth_date`）。 |
| **データ型** | `VARCHAR`, `INTEGER`, `DATE`, `DECIMAL` など。 |
| **桁数・精度** | 最大文字数や、数値の有効桁数・小数部桁数。 |
| **主キー (PK)** | その項目が主キーかどうか（○か空欄か）。 |
| **外部キー (FK)** | 他のテーブルを参照している場合、その参照先テーブルとカラム名。 |
| **Not Null制約** | 必須項目かどうか。 |
| **一意制約 (Unique)** | 重複を許さない項目かどうか。 |
| **デフォルト値** | 値が未指定の場合に自動で入る値（例：登録日時に `CURRENT_TIMESTAMP`）。 |

---

### 3. ビジネスルール・値の制約

単なる型定義だけでなく、業務上のルールを定義します。

* **有効値（コード定義）**:
  * 区分値の内容を定義します。
  * 例：「ステータス」カラムの場合（0：仮登録、1：本登録、9：退会）。
* **チェック制約（バリデーション）**:
  * 入力される値の範囲や形式。
  * 例：「年齢は0以上150以下」「郵便番号はハイフンなし7桁」など。
* **算出ロジック**:
  * その項目が他の項目の計算結果である場合、その計算式。
  * 例：`tax_amount`（消費税額） ＝ `subtotal` × 0.1（端数切り捨て）。

---

### 4. 付加情報（運用・セキュリティ）

開発後の運用やデータ活用を見据えた項目です。

* **個人情報・機密区分**: 
  * その項目が個人情報（氏名、住所等）か、機密情報（パスワード、給与等）かを明記し、閲覧制限や暗号化の判断材料にします。
* **更新不可属性**: 一度登録したら変更できない項目（例：登録日時、注文番号）。
* **インデックス情報**: 検索速度向上のためにインデックスを貼るカラムの指定。
* **サンプル値**: 実際にどのようなデータが入るかの具体例。

---

### データ仕様書のイメージ（例）

| No | 論理名 | 物理名 | 型 | 桁数 | PK | NotNull | デフォルト | 備考・コード定義 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 顧客ID | `cust_id` | `CHAR` | 10 | ○ | ○ | - | 固定10桁（C+連番） |
| 2 | 顧客名 | `cust_name` | `VARCHAR` | 100 | - | ○ | - | |
| 3 | 会員ランク | `rank_cls` | `CHAR` | 1 | - | ○ | '1' | 1:一般, 2:シルバー, 3:ゴールド |
| 4 | 登録日時 | `ins_date` | `DATETIME` | - | - | ○ | `now()` | システムにて自動設定 |

---

### 作成時のポイント

* **「コード定義」は別シートに分けるのもアリ**: 
  * 区分値（ステータスや種類など）が多い場合、テーブル定義内に書くと煩雑になるため、「コード一覧」として別管理にすることが多いです。
* **共通カラムのルール化**: 
  * 「登録者ID」「登録日時」「更新日時」「削除フラグ」など、全テーブルに共通して持たせる項目（共通カラム）は、プロジェクト全体でルール化して記載漏れを防ぎます。
* **「論理名」はビジネス用語集と一致させる**: 
  * 先ほど定義した「用語の定義」と名前がズレないようにします。
